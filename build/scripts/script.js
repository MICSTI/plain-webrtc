var app=angular.module("plain-webrtc",["ui.router","ngMessages"]);app.constant("AppConfig",{"log.info":!0,"log.error":!0}),app.controller("AppCtrl",["$scope","LogSrv","SocketSrv","FocusSrv","WebRTCSrv",function(n,e,t,o,c){var i={username:null},r=null,a=null,l=function(n){r=n,t.sendMessage({to:r.id,topic:"call.offer",payload:{}}),a="call.outgoing"},s=function(){t.sendMessage({to:r.id,topic:"call.withdrawn",payload:{}}),r=null,a=null},u=function(){t.sendMessage({to:r.id,topic:"call.rejected",payload:{}}),r=null,a=null},d=function(){t.sendMessage({to:r.id,topic:"call.accepted",payload:{}}),a="call.accepted",c.setRemotePeer(r)},f=function(){t.sendMessage({to:r.id,topic:"call.hangup",payload:{}}),c.closeConnection()};t.connect(),n.isLoggedIn=function(){return null!==i.username},n.userObj={},n.login=function(o){o?(i.username=n.userObj.username,t.register(i.username)):e.error("Form not valid")},n.user=function(){return i},n.peers=function(){return t.getUsers()},n.getInfoMessage=function(){return a},n.getRemotePeer=function(){return r},n.callUser=l,n.withdrawCall=s,n.rejectCall=u,n.acceptCall=d,n.hangUp=f,n.isConnected=c.isConnected,o("username"),n.$on("call.offer",function(n,e){r=t.findUserById(e.from),a="call.incoming"}),n.$on("call.withdrawn",function(n,e){r=null,a=null}),n.$on("call.rejected",function(n,e){r=null,a=null}),n.$on("call.accepted",function(n,e){a="call.accepted",c.setRemotePeer(r),c.establishConnection({initiator:!0})}),n.$on("call.hangup",function(n,e){c.closeConnection()}),n.$on("webrtc.connected",function(e,t){n.$apply(function(){a=null}),o("chatMessage")}),n.$on("webrtc.disconnected",function(e,t){n.$apply(function(){a=null})})}]),angular.module("plain-webrtc").controller("RealTimeVideoController",["$scope",function(n){}]),angular.module("plain-webrtc").directive("realTimeVideo",function(){return{template:'<video class="video"></video>',restrict:"E",controller:"RealTimeVideoController",link:function(n,e,t){var o,c,i=e[0].querySelector("video");i.autoplay=!0,i.srcObject=null,i.onloadedmetadata=function(){o=this.videoWidth,c=this.videoHeight},n.$on("webrtc.connected",function(n,e){i.srcObject=e.stream})}}}),angular.module("plain-webrtc").factory("FocusSrv",["$timeout","$window",function(n,e){return function(t){n(function(){var n=e.document.getElementById(t);n&&n.focus()})}}]),angular.module("plain-webrtc").factory("LogSrv",["AppConfig",function(n){var e=function(){n["log.info"]&&console.log.apply(console,arguments)},t=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:e,error:t}}]),angular.module("plain-webrtc").factory("SocketSrv",["$rootScope","LogSrv",function(n,e){var t=null,o=[],c=null,i=function(e,o){t.on(e,function(){var e=arguments;n.$apply(function(){o.apply(t,e)})})},r=function(){t=io.connect(),e.info("Socket connected"),i("id",function(n){c=n}),i("users.update",function(n){a(n)}),i("msg",function(e){var t=e.topic;delete e.topic,n.$broadcast(t,e)})},a=function(n){o=n.filter(function(n){return n.id!==c})},l=function(n){t.emit("register",{username:n})},s=function(n){t.emit("msg",n)},u=function(n){var e=null;return o.forEach(function(t){t.id===n&&(e=t)}),e};return{connect:r,register:l,findUserById:u,sendMessage:s,getUsers:function(){return o}}}]),angular.module("plain-webrtc").factory("WebRTCSrv",["$rootScope","LogSrv","SocketSrv",function(n,e,t){var o=null,c=null,i=null,r=null,a="plain-webrtc-channel",l=null,s={peerConnectionConfig:{iceServers:[{urls:["stun:23.21.150.121"]},{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:numb.viagenie.ca?transport=udp"],username:"michael.stifter@evolaris.net",credential:"15uFbuCxazKrMzog2WnM"},{urls:["turn:numb.viagenie.ca?transport=tcp"],username:"michael.stifter@evolaris.net",credential:"15uFbuCxazKrMzog2WnM"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0}]},userMediaConstraints:{audio:!0,video:{width:480,height:360}}},u=function(){i=new RTCPeerConnection(s.peerConnectionConfig,s.peerConnectionConstraints),e.info("--- peer connection created ---",s.peerConnectionConfig,s.peerConnectionConstraints),i.addStream(o),e.info("--- local stream added ---"),i.onaddstream=p,i.onremovestream=g,i.oniceconnectionstatechange=m,i.onicecandidate=function(n){n.candidate&&t.sendMessage({to:l.id,topic:"webrtc.candidate",payload:{label:n.candidate.sdpMLineIndex,id:n.candidate.sdpMid,candidate:n.candidate.candidate}})},i.ondatachannel=function(n){e.info("--- data channel received ---",n.channel),r=n.channel,r.onopen=h,r.onmessage=C,r.onclose=h,r.onerror=function(n){e.error("data channel error",n)}}},d=function(){e.info("--- creating offer ---"),i.createOffer().then(function(n){i.setLocalDescription(n),t.sendMessage({to:l.id,topic:"webrtc.offer",payload:n})}).catch(function(n){e.error("Failed to create offer",n)})},f=function(){e.info("--- creating answer ---"),i.createAnswer().then(function(n){i.setLocalDescription(n),t.sendMessage({to:l.id,topic:"webrtc.answer",payload:n})}).catch(function(n){e.error("failed to set local description",n)})},p=function(n){e.info("--- remote stream added ---"),n.stream.getTracks().forEach(function(n){e.info("REMOTE STREAM TRACK",n)}),c=n.stream},g=function(n){e.info("--- remote stream removed ---")},m=function(t){var o=(t.srcElement||t.target).iceConnectionState;switch(o){case"connected":e.info("--- connected ---"),n.$broadcast("webrtc.connected",{stream:c});break;case"closed":e.info("--- closed ---"),n.$broadcast("webrtc.disconnected");break;case"disconnected":e.info("--- disconnected ---"),n.$broadcast("webrtc.disconnected"),S();break;case"failed":e.error("--- failed ---",t),v();break;default:e.info("--- ICE connection state change ---",o)}},h=function(){e.info("--- data channel state: "+r.readyState+" ---")},C=function(n){var t=null;try{t=JSON.parse(n.data)}catch(n){t=null}e.info("--- data channel message ---",t)},b=function(n){return new Promise(function(n,t){navigator.mediaDevices.getUserMedia(s.userMediaConstraints).then(function(t){o=t,e.info("--- got media access ---",s.userMediaConstraints),n(o)}).catch(function(n){e.error("Failed to obtain media access for options",s.userMediaConstraints,n),t(n)})})},v=function(){return new Promise(function(n,e){null===o&&n();var t=o.getTracks();t.forEach(function(n){n.stop()}),o=null,n()})},w=function(n){b().then(function(){t.sendMessage({to:l.id,topic:"webrtc.init",payload:{}}),u()}).catch(function(n){})},y=function(){null!==i&&i.close(),i=null,o=null,c=null},S=function(){null!==i&&(e.info("--- closing WebRTC connection ---"),v().then(function(){y(),M(null)}))},M=function(n){l=n},$=function(){return null!==i};return n.$on("webrtc.init",function(n,t){e.info("--- received WebRTC init ---"),b().then(function(){u();try{r=i.createDataChannel(a,{reliable:!0}),e.info("--- data channel created ---"),r.onopen=h,r.onmessage=C,r.onclose=h,r.onerror=function(n){e.error("data channel error",n)}}catch(n){e.error("failed to create data channel",n),r=null}d()}).catch(function(n){})}),n.$on("webrtc.offer",function(n,t){e.info("--- received offer ---",t),i.setRemoteDescription(new RTCSessionDescription(t.payload)).then(function(){e.info("--- set remote description ---"),f()}).catch(function(n){e.error("failed to set remote description",n)})}),n.$on("webrtc.answer",function(n,t){e.info("--- received answer ---",t),i.setRemoteDescription(new RTCSessionDescription(t.payload)).then(function(){e.info("--- set remote description ---")}).catch(function(n){e.error("failed to set remote description",n)})}),n.$on("webrtc.candidate",function(n,t){i.remoteDescription&&i.addIceCandidate(new RTCIceCandidate(t.payload)).then(function(){e.info("--- added ICE candidate ---")}).catch(function(n){e.error("failed to add ICE candidate",n)})}),{init:u,establishConnection:w,closeConnection:S,setRemotePeer:M,isConnected:$}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzL3JlYWwtdGltZS12aWRlby5jb250cm9sbGVyLmpzIiwiZGlyZWN0aXZlcy92aWRlb0RpcmVjdGl2ZS5qcyIsInNlcnZpY2VzL2ZvY3VzLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9sb2cuc2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldC5pby5jbGllbnQuc2VydmljZS5qcyIsInNlcnZpY2VzL3dlYnJ0Yy5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwiY29udHJvbGxlciIsIiRzY29wZSIsIkxvZ1NydiIsIlNvY2tldFNydiIsIkZvY3VzU3J2IiwiV2ViUlRDU3J2IiwidXNlciIsInVzZXJuYW1lIiwicmVtb3RlUGVlciIsInVpTWVzc2FnZSIsImNhbGxVc2VyIiwiX3JlbW90ZVBlZXIiLCJzZW5kTWVzc2FnZSIsInRvIiwiaWQiLCJ0b3BpYyIsInBheWxvYWQiLCJ3aXRoZHJhd0NhbGwiLCJyZWplY3RDYWxsIiwiYWNjZXB0Q2FsbCIsInNldFJlbW90ZVBlZXIiLCJoYW5nVXAiLCJjbG9zZUNvbm5lY3Rpb24iLCJjb25uZWN0IiwiaXNMb2dnZWRJbiIsInVzZXJPYmoiLCJsb2dpbiIsImlzVmFsaWQiLCJyZWdpc3RlciIsImVycm9yIiwicGVlcnMiLCJnZXRVc2VycyIsImdldEluZm9NZXNzYWdlIiwiZ2V0UmVtb3RlUGVlciIsImlzQ29ubmVjdGVkIiwiJG9uIiwiZXZlbnQiLCJkYXRhIiwiZmluZFVzZXJCeUlkIiwiZnJvbSIsImVzdGFibGlzaENvbm5lY3Rpb24iLCJpbml0aWF0b3IiLCIkYXBwbHkiLCJkaXJlY3RpdmUiLCJ0ZW1wbGF0ZSIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwidmlkZW9XaWR0aCIsInZpZGVvSGVpZ2h0IiwidmlkZW8iLCJxdWVyeVNlbGVjdG9yIiwiYXV0b3BsYXkiLCJzcmNPYmplY3QiLCJvbmxvYWRlZG1ldGFkYXRhIiwidGhpcyIsInN0cmVhbSIsImZhY3RvcnkiLCIkdGltZW91dCIsIiR3aW5kb3ciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZm9jdXMiLCJBcHBDb25maWciLCJsb2dJbmZvIiwiY29uc29sZSIsImxvZyIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9nRXJyb3IiLCJpbmZvIiwiJHJvb3RTY29wZSIsInNvY2tldCIsInVzZXJzIiwib3duSWQiLCJvbiIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImlvIiwicGFyc2VVc2VyQXJyYXkiLCIkYnJvYWRjYXN0IiwiX3VzZXJzIiwiZmlsdGVyIiwiZW1pdCIsIm1lc3NhZ2UiLCJmb3JFYWNoIiwidSIsImxvY2FsU3RyZWFtIiwicmVtb3RlU3RyZWFtIiwicGVlckNvbm5lY3Rpb24iLCJkYXRhQ2hhbm5lbCIsImRhdGFDaGFubmVsTmFtZSIsImNvbmZpZyIsInBlZXJDb25uZWN0aW9uQ29uZmlnIiwiaWNlU2VydmVycyIsInVybHMiLCJjcmVkZW50aWFsIiwicGVlckNvbm5lY3Rpb25Db25zdHJhaW50cyIsIm9wdGlvbmFsIiwiRHRsc1NydHBLZXlBZ3JlZW1lbnQiLCJ1c2VyTWVkaWFDb25zdHJhaW50cyIsImF1ZGlvIiwid2lkdGgiLCJoZWlnaHQiLCJpbml0IiwiUlRDUGVlckNvbm5lY3Rpb24iLCJhZGRTdHJlYW0iLCJvbmFkZHN0cmVhbSIsImhhbmRsZVJlbW90ZVN0cmVhbUFkZGVkIiwib25yZW1vdmVzdHJlYW0iLCJoYW5kbGVSZW1vdGVTdHJlYW1SZW1vdmVkIiwib25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UiLCJoYW5kbGVJY2VDb25uZWN0aW9uU3RhdGVDaGFuZ2UiLCJvbmljZWNhbmRpZGF0ZSIsImNhbmRpZGF0ZSIsImxhYmVsIiwic2RwTUxpbmVJbmRleCIsInNkcE1pZCIsIm9uZGF0YWNoYW5uZWwiLCJjaGFubmVsIiwib25vcGVuIiwiaGFuZGxlRGF0YUNoYW5uZWxTdGF0ZUNoYW5nZSIsIm9ubWVzc2FnZSIsImhhbmRsZURhdGFDaGFubmVsTWVzc2FnZSIsIm9uY2xvc2UiLCJvbmVycm9yIiwiZXJyIiwib2ZmZXIiLCJjcmVhdGVPZmZlciIsInRoZW4iLCJzZXNzaW9uRGVzY3JpcHRpb24iLCJzZXRMb2NhbERlc2NyaXB0aW9uIiwiY2F0Y2giLCJhbnN3ZXIiLCJjcmVhdGVBbnN3ZXIiLCJnZXRUcmFja3MiLCJ0cmFjayIsInN0YXRlIiwic3JjRWxlbWVudCIsInRhcmdldCIsImljZUNvbm5lY3Rpb25TdGF0ZSIsImNsb3NlV2ViUlRDQ29ubmVjdGlvbiIsInJlbGVhc2VNZWRpYUFjY2VzcyIsInJlYWR5U3RhdGUiLCJKU09OIiwicGFyc2UiLCJleCIsInJlcXVlc3RNZWRpYUFjY2VzcyIsIm9wdGlvbnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImdldFVzZXJNZWRpYSIsIm1lZGlhU3RyZWFtIiwidHJhY2tzIiwic3RvcCIsImhhbmd1cCIsImNsb3NlIiwicGVlciIsImNyZWF0ZURhdGFDaGFubmVsIiwicmVsaWFibGUiLCJzZXRSZW1vdGVEZXNjcmlwdGlvbiIsIlJUQ1Nlc3Npb25EZXNjcmlwdGlvbiIsInJlbW90ZURlc2NyaXB0aW9uIiwiYWRkSWNlQ2FuZGlkYXRlIiwiUlRDSWNlQ2FuZGlkYXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGdCQUNBLFlBQ0EsY0FJQUYsS0FBQUcsU0FBQSxhQUNBQyxZQUFBLEVBQ0FDLGFBQUEsSUFHQUwsSUFBQU0sV0FBQSxXQUFBLFNBQUEsU0FBQSxZQUFBLFdBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBLEdBQUFDLElBQ0FDLFNBQUEsTUFHQUMsRUFBQSxLQUNBQyxFQUFBLEtBRUFDLEVBQUEsU0FBQUMsR0FDQUgsRUFBQUcsRUFHQVIsRUFBQVMsYUFDQUMsR0FBQUwsRUFBQU0sR0FDQUMsTUFBQSxhQUNBQyxhQU1BUCxFQUFBLGlCQUdBUSxFQUFBLFdBRUFkLEVBQUFTLGFBQ0FDLEdBQUFMLEVBQUFNLEdBQ0FDLE1BQUEsaUJBQ0FDLGFBTUFSLEVBQUEsS0FHQUMsRUFBQSxNQUdBUyxFQUFBLFdBRUFmLEVBQUFTLGFBQ0FDLEdBQUFMLEVBQUFNLEdBQ0FDLE1BQUEsZ0JBQ0FDLGFBTUFSLEVBQUEsS0FHQUMsRUFBQSxNQUdBVSxFQUFBLFdBRUFoQixFQUFBUyxhQUNBQyxHQUFBTCxFQUFBTSxHQUNBQyxNQUFBLGdCQUNBQyxhQU1BUCxFQUFBLGdCQUdBSixFQUFBZSxjQUFBWixJQUdBYSxFQUFBLFdBRUFsQixFQUFBUyxhQUNBQyxHQUFBTCxFQUFBTSxHQUNBQyxNQUFBLGNBQ0FDLGFBS0FYLEVBQUFpQixrQkFJQW5CLEdBQUFvQixVQUdBdEIsRUFBQXVCLFdBQUEsV0FDQSxNQUFBLFFBQUFsQixFQUFBQyxVQUdBTixFQUFBd0IsV0FFQXhCLEVBQUF5QixNQUFBLFNBQUFDLEdBQ0FBLEdBQ0FyQixFQUFBQyxTQUFBTixFQUFBd0IsUUFBQWxCLFNBR0FKLEVBQUF5QixTQUFBdEIsRUFBQUMsV0FFQUwsRUFBQTJCLE1BQUEsbUJBSUE1QixFQUFBSyxLQUFBLFdBQ0EsTUFBQUEsSUFHQUwsRUFBQTZCLE1BQUEsV0FDQSxNQUFBM0IsR0FBQTRCLFlBR0E5QixFQUFBK0IsZUFBQSxXQUNBLE1BQUF2QixJQUdBUixFQUFBZ0MsY0FBQSxXQUNBLE1BQUF6QixJQUdBUCxFQUFBUyxTQUFBQSxFQUNBVCxFQUFBZ0IsYUFBQUEsRUFDQWhCLEVBQUFpQixXQUFBQSxFQUNBakIsRUFBQWtCLFdBQUFBLEVBQ0FsQixFQUFBb0IsT0FBQUEsRUFDQXBCLEVBQUFpQyxZQUFBN0IsRUFBQTZCLFlBRUE5QixFQUFBLFlBSUFILEVBQUFrQyxJQUFBLGFBQUEsU0FBQUMsRUFBQUMsR0FFQTdCLEVBQUFMLEVBQUFtQyxhQUFBRCxFQUFBRSxNQUdBOUIsRUFBQSxrQkFHQVIsRUFBQWtDLElBQUEsaUJBQUEsU0FBQUMsRUFBQUMsR0FFQTdCLEVBQUEsS0FHQUMsRUFBQSxPQUdBUixFQUFBa0MsSUFBQSxnQkFBQSxTQUFBQyxFQUFBQyxHQUVBN0IsRUFBQSxLQUdBQyxFQUFBLE9BR0FSLEVBQUFrQyxJQUFBLGdCQUFBLFNBQUFDLEVBQUFDLEdBRUE1QixFQUFBLGdCQUdBSixFQUFBZSxjQUFBWixHQUdBSCxFQUFBbUMscUJBQ0FDLFdBQUEsTUFJQXhDLEVBQUFrQyxJQUFBLGNBQUEsU0FBQUMsRUFBQUMsR0FDQWhDLEVBQUFpQixvQkFHQXJCLEVBQUFrQyxJQUFBLG1CQUFBLFNBQUFDLEVBQUFDLEdBQ0FwQyxFQUFBeUMsT0FBQSxXQUVBakMsRUFBQSxPQUdBTCxFQUFBLGlCQUdBSCxFQUFBa0MsSUFBQSxzQkFBQSxTQUFBQyxFQUFBQyxHQUNBcEMsRUFBQXlDLE9BQUEsV0FFQWpDLEVBQUEsWUN2TUFkLFFBQ0FDLE9BQUEsZ0JBQ0FJLFdBQUEsMkJBQUEsU0FBQSxTQUFBQyxPQ0ZBTixRQUNBQyxPQUFBLGdCQUNBK0MsVUFBQSxnQkFBQSxXQUNBLE9BQ0FDLFNBQUEsZ0NBQ0FDLFNBQUEsSUFDQTdDLFdBQUEsMEJBQ0E4QyxLQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsR0FFQUMsR0FBQUMsRUFGQUMsRUFBQUosRUFBQSxHQUFBSyxjQUFBLFFBSUFELEdBQUFFLFVBQUEsRUFDQUYsRUFBQUcsVUFBQSxLQUVBSCxFQUFBSSxpQkFBQSxXQUNBTixFQUFBTyxLQUFBUCxXQUNBQyxFQUFBTSxLQUFBTixhQUdBSixFQUFBWixJQUFBLG1CQUFBLFNBQUFDLEVBQUFDLEdBQ0FlLEVBQUFHLFVBQUFsQixFQUFBcUIsYUNyQkEvRCxRQUNBQyxPQUFBLGdCQUNBK0QsUUFBQSxZQUFBLFdBQUEsVUFBQSxTQUFBQyxFQUFBQyxHQUNBLE1BQUEsVUFBQS9DLEdBS0E4QyxFQUFBLFdBQ0EsR0FBQVosR0FBQWEsRUFBQUMsU0FBQUMsZUFBQWpELEVBRUFrQyxJQUNBQSxFQUFBZ0IsY0NaQXJFLFFBQ0FDLE9BQUEsZ0JBQ0ErRCxRQUFBLFVBQUEsWUFBQSxTQUFBTSxHQUNBLEdBQUFDLEdBQUEsV0FDQUQsRUFBQSxhQUNBRSxRQUFBQyxJQUFBQyxNQUFBRixRQUFBRyxZQUlBQyxFQUFBLFdBQ0FOLEVBQUEsY0FDQUUsUUFBQXRDLE1BQUF3QyxNQUFBRixRQUFBRyxXQUlBLFFBQ0FFLEtBQUFOLEVBQ0FyQyxNQUFBMEMsTUNqQkE1RSxRQUFBQyxPQUFBLGdCQUNBK0QsUUFBQSxhQUFBLGFBQUEsU0FBQSxTQUFBYyxFQUFBdkUsR0FDQSxHQUFBd0UsR0FBQSxLQUNBQyxLQUNBQyxFQUFBLEtBRUFDLEVBQUEsU0FBQUMsRUFBQUMsR0FDQUwsRUFBQUcsR0FBQUMsRUFBQSxXQUNBLEdBQUFFLEdBQUFWLFNBRUFHLEdBQUEvQixPQUFBLFdBQ0FxQyxFQUFBVixNQUFBSyxFQUFBTSxRQWlCQXpELEVBQUEsV0FFQW1ELEVBQUFPLEdBQUExRCxVQUVBckIsRUFBQXNFLEtBQUEsb0JBRUFLLEVBQUEsS0FBQSxTQUFBeEMsR0FDQXVDLEVBQUF2QyxJQUdBd0MsRUFBQSxlQUFBLFNBQUF4QyxHQUNBNkMsRUFBQTdDLEtBR0F3QyxFQUFBLE1BQUEsU0FBQXhDLEdBQ0EsR0FBQXRCLEdBQUFzQixFQUFBdEIsWUFFQXNCLEdBQUF0QixNQUdBMEQsRUFBQVUsV0FBQXBFLEVBQUFzQixNQUlBNkMsRUFBQSxTQUFBRSxHQUNBVCxFQUFBUyxFQUFBQyxPQUFBLFNBQUEvRSxHQUNBLE1BQUFBLEdBQUFRLEtBQUE4RCxLQUlBaEQsRUFBQSxTQUFBckIsR0FDQW1FLEVBQUFZLEtBQUEsWUFDQS9FLFNBQUFBLEtBSUFLLEVBQUEsU0FBQTJFLEdBQ0FiLEVBQUFZLEtBQUEsTUFBQUMsSUFHQWpELEVBQUEsU0FBQXhCLEdBQ0EsR0FBQVIsR0FBQSxJQVFBLE9BTkFxRSxHQUFBYSxRQUFBLFNBQUFDLEdBQ0FBLEVBQUEzRSxLQUFBQSxJQUNBUixFQUFBbUYsS0FJQW5GLEVBR0EsUUFDQWlCLFFBQUFBLEVBQ0FLLFNBQUFBLEVBQ0FVLGFBQUFBLEVBQ0ExQixZQUFBQSxFQUNBbUIsU0FBQSxXQUNBLE1BQUE0QyxRQ3RGQWhGLFFBQUFDLE9BQUEsZ0JBQ0ErRCxRQUFBLGFBQUEsYUFBQSxTQUFBLFlBQUEsU0FBQWMsRUFBQXZFLEVBQUFDLEdBQ0EsR0FBQXVGLEdBQUEsS0FDQUMsRUFBQSxLQUNBQyxFQUFBLEtBRUFDLEVBQUEsS0FDQUMsRUFBQSx1QkFFQXRGLEVBQUEsS0FHQXVGLEdBQ0FDLHNCQUVBQyxhQUNBQyxNQUFBLHdCQUNBQSxNQUFBLGtDQUNBQSxNQUFBLHVDQUFBM0YsU0FBQSwrQkFBQTRGLFdBQUEseUJBQ0FELE1BQUEsdUNBQUEzRixTQUFBLCtCQUFBNEYsV0FBQSwwQkFHQUMsMkJBQ0FDLFdBQ0FDLHNCQUFBLEtBR0FDLHNCQUNBQyxPQUFBLEVBQ0FwRCxPQUNBcUQsTUFBQSxJQUNBQyxPQUFBLE9BS0FDLEVBQUEsV0FDQWYsRUFBQSxHQUFBZ0IsbUJBQUFiLEVBQUFDLHFCQUFBRCxFQUFBSywyQkFFQWxHLEVBQUFzRSxLQUFBLGtDQUFBdUIsRUFBQUMscUJBQUFELEVBQUFLLDJCQUVBUixFQUFBaUIsVUFBQW5CLEdBQ0F4RixFQUFBc0UsS0FBQSw4QkFFQW9CLEVBQUFrQixZQUFBQyxFQUNBbkIsRUFBQW9CLGVBQUFDLEVBQ0FyQixFQUFBc0IsMkJBQUFDLEVBRUF2QixFQUFBd0IsZUFBQSxTQUFBaEYsR0FDQUEsRUFBQWlGLFdBQ0FsSCxFQUFBUyxhQUNBQyxHQUFBTCxFQUFBTSxHQUNBQyxNQUFBLG1CQUNBQyxTQUNBc0csTUFBQWxGLEVBQUFpRixVQUFBRSxjQUNBekcsR0FBQXNCLEVBQUFpRixVQUFBRyxPQUNBSCxVQUFBakYsRUFBQWlGLFVBQUFBLGNBTUF6QixFQUFBNkIsY0FBQSxTQUFBckYsR0FDQWxDLEVBQUFzRSxLQUFBLGdDQUFBcEMsRUFBQXNGLFNBRUE3QixFQUFBekQsRUFBQXNGLFFBRUE3QixFQUFBOEIsT0FBQUMsRUFDQS9CLEVBQUFnQyxVQUFBQyxFQUNBakMsRUFBQWtDLFFBQUFILEVBQ0EvQixFQUFBbUMsUUFBQSxTQUFBQyxHQUNBL0gsRUFBQTJCLE1BQUEscUJBQUFvRyxNQUtBQyxFQUFBLFdBQ0FoSSxFQUFBc0UsS0FBQSwwQkFFQW9CLEVBQUF1QyxjQUNBQyxLQUFBLFNBQUFDLEdBQ0F6QyxFQUFBMEMsb0JBQUFELEdBRUFsSSxFQUFBUyxhQUNBQyxHQUFBTCxFQUFBTSxHQUNBQyxNQUFBLGVBQ0FDLFFBQUFxSCxNQUdBRSxNQUFBLFNBQUFOLEdBQ0EvSCxFQUFBMkIsTUFBQSx5QkFBQW9HLE1BSUFPLEVBQUEsV0FDQXRJLEVBQUFzRSxLQUFBLDJCQUVBb0IsRUFBQTZDLGVBQ0FMLEtBQUEsU0FBQUMsR0FDQXpDLEVBQUEwQyxvQkFBQUQsR0FFQWxJLEVBQUFTLGFBQ0FDLEdBQUFMLEVBQUFNLEdBQ0FDLE1BQUEsZ0JBQ0FDLFFBQUFxSCxNQUdBRSxNQUFBLFNBQUFOLEdBQ0EvSCxFQUFBMkIsTUFBQSxrQ0FBQW9HLE1BSUFsQixFQUFBLFNBQUEzRSxHQUNBbEMsRUFBQXNFLEtBQUEsK0JBRUFwQyxFQUFBc0IsT0FBQWdGLFlBQUFsRCxRQUFBLFNBQUFtRCxHQUNBekksRUFBQXNFLEtBQUEsc0JBQUFtRSxLQUlBaEQsRUFBQXZELEVBQUFzQixRQUdBdUQsRUFBQSxTQUFBN0UsR0FDQWxDLEVBQUFzRSxLQUFBLGtDQUdBMkMsRUFBQSxTQUFBL0UsR0FDQSxHQUFBd0csSUFBQXhHLEVBQUF5RyxZQUFBekcsRUFBQTBHLFFBQUFDLGtCQUVBLFFBQUFILEdBQ0EsSUFBQSxZQUNBMUksRUFBQXNFLEtBQUEscUJBRUFDLEVBQUFVLFdBQUEsb0JBQ0F6QixPQUFBaUMsR0FHQSxNQUVBLEtBQUEsU0FDQXpGLEVBQUFzRSxLQUFBLGtCQUVBQyxFQUFBVSxXQUFBLHNCQUVBLE1BRUEsS0FBQSxlQUNBakYsRUFBQXNFLEtBQUEsd0JBRUFDLEVBQUFVLFdBQUEsdUJBRUE2RCxHQUVBLE1BRUEsS0FBQSxTQUNBOUksRUFBQTJCLE1BQUEsaUJBQUFPLEdBR0E2RyxHQUVBLE1BRUEsU0FDQS9JLEVBQUFzRSxLQUFBLHNDQUFBb0UsS0FJQWhCLEVBQUEsV0FDQTFILEVBQUFzRSxLQUFBLDJCQUFBcUIsRUFBQXFELFdBQUEsU0FHQXBCLEVBQUEsU0FBQTFGLEdBQ0EsR0FBQW1ELEdBQUEsSUFDQSxLQUNBQSxFQUFBNEQsS0FBQUMsTUFBQWhILEVBQUFDLE1BQ0EsTUFBQWdILEdBQ0E5RCxFQUFBLEtBR0FyRixFQUFBc0UsS0FBQSwrQkFBQWUsSUFHQStELEVBQUEsU0FBQUMsR0FDQSxNQUFBLElBQUFDLFNBQUEsU0FBQUMsRUFBQUMsR0FDQUMsVUFDQUMsYUFDQUMsYUFBQTlELEVBQUFRLHNCQUNBNkIsS0FBQSxTQUFBMEIsR0FDQXBFLEVBQUFvRSxFQUVBNUosRUFBQXNFLEtBQUEsMkJBQUF1QixFQUFBUSxzQkFFQWtELEVBQUEvRCxLQUVBNkMsTUFBQSxTQUFBTixHQUNBL0gsRUFBQTJCLE1BQUEsNENBQUFrRSxFQUFBUSxxQkFBQTBCLEdBQ0F5QixFQUFBekIsUUFLQWdCLEVBQUEsV0FDQSxNQUFBLElBQUFPLFNBQUEsU0FBQUMsRUFBQUMsR0FFQSxPQUFBaEUsR0FDQStELEdBR0EsSUFBQU0sR0FBQXJFLEVBQUFnRCxXQUVBcUIsR0FBQXZFLFFBQUEsU0FBQW1ELEdBQ0FBLEVBQUFxQixTQUdBdEUsRUFBQSxLQUVBK0QsT0FJQWpILEVBQUEsU0FBQStHLEdBQ0FELElBQ0FsQixLQUFBLFdBRUFqSSxFQUFBUyxhQUNBQyxHQUFBTCxFQUFBTSxHQUNBQyxNQUFBLGNBQ0FDLGFBTUEyRixNQUVBNEIsTUFBQSxTQUFBTixPQUtBZ0MsRUFBQSxXQUNBLE9BQUFyRSxHQUNBQSxFQUFBc0UsUUFHQXRFLEVBQUEsS0FFQUYsRUFBQSxLQUNBQyxFQUFBLE1BR0FxRCxFQUFBLFdBQ0EsT0FBQXBELElBQ0ExRixFQUFBc0UsS0FBQSxxQ0FFQXlFLElBQ0FiLEtBQUEsV0FDQTZCLElBRUE3SSxFQUFBLFVBS0FBLEVBQUEsU0FBQStJLEdBQ0EzSixFQUFBMkosR0FHQWpJLEVBQUEsV0FDQSxNQUFBLFFBQUEwRCxFQTJFQSxPQXhFQW5CLEdBQUF0QyxJQUFBLGNBQUEsU0FBQUMsRUFBQUMsR0FDQW5DLEVBQUFzRSxLQUFBLGdDQUVBOEUsSUFDQWxCLEtBQUEsV0FFQXpCLEdBR0EsS0FDQWQsRUFBQUQsRUFBQXdFLGtCQUFBdEUsR0FBQXVFLFVBQUEsSUFFQW5LLEVBQUFzRSxLQUFBLGdDQUVBcUIsRUFBQThCLE9BQUFDLEVBQ0EvQixFQUFBZ0MsVUFBQUMsRUFDQWpDLEVBQUFrQyxRQUFBSCxFQUNBL0IsRUFBQW1DLFFBQUEsU0FBQUMsR0FDQS9ILEVBQUEyQixNQUFBLHFCQUFBb0csSUFFQSxNQUFBb0IsR0FDQW5KLEVBQUEyQixNQUFBLGdDQUFBd0gsR0FDQXhELEVBQUEsS0FJQXFDLE1BRUFLLE1BQUEsU0FBQU4sUUFLQXhELEVBQUF0QyxJQUFBLGVBQUEsU0FBQUMsRUFBQUMsR0FDQW5DLEVBQUFzRSxLQUFBLHlCQUFBbkMsR0FFQXVELEVBQUEwRSxxQkFBQSxHQUFBQyx1QkFBQWxJLEVBQUFyQixVQUNBb0gsS0FBQSxXQUNBbEksRUFBQXNFLEtBQUEsa0NBR0FnRSxNQUVBRCxNQUFBLFNBQUFOLEdBQ0EvSCxFQUFBMkIsTUFBQSxtQ0FBQW9HLE9BSUF4RCxFQUFBdEMsSUFBQSxnQkFBQSxTQUFBQyxFQUFBQyxHQUNBbkMsRUFBQXNFLEtBQUEsMEJBQUFuQyxHQUVBdUQsRUFBQTBFLHFCQUFBLEdBQUFDLHVCQUFBbEksRUFBQXJCLFVBQ0FvSCxLQUFBLFdBQ0FsSSxFQUFBc0UsS0FBQSxvQ0FFQStELE1BQUEsU0FBQU4sR0FDQS9ILEVBQUEyQixNQUFBLG1DQUFBb0csT0FJQXhELEVBQUF0QyxJQUFBLG1CQUFBLFNBQUFDLEVBQUFDLEdBQ0F1RCxFQUFBNEUsbUJBQ0E1RSxFQUFBNkUsZ0JBQUEsR0FBQUMsaUJBQUFySSxFQUFBckIsVUFDQW9ILEtBQUEsV0FDQWxJLEVBQUFzRSxLQUFBLGlDQUVBK0QsTUFBQSxTQUFBTixHQUNBL0gsRUFBQTJCLE1BQUEsOEJBQUFvRyxRQU1BdEIsS0FBQUEsRUFDQW5FLG9CQUFBQSxFQUNBbEIsZ0JBQUEwSCxFQUNBNUgsY0FBQUEsRUFDQWMsWUFBQUEiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwicGxhaW4td2VicnRjXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nTWVzc2FnZXMnXHJcbl0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5hcHAuY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZVxyXG59KTtcclxuXHJcbmFwcC5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgU29ja2V0U3J2LCBGb2N1c1NydiwgV2ViUlRDU3J2KSB7XHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgY29uZmlnIC0tLS0tLS0tLS0tLVxyXG4gICAgdmFyIHVzZXIgPSB7XHJcbiAgICAgICAgdXNlcm5hbWU6IG51bGxcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHJlbW90ZVBlZXIgPSBudWxsO1xyXG4gICAgdmFyIHVpTWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgdmFyIGNhbGxVc2VyID0gZnVuY3Rpb24oX3JlbW90ZVBlZXIpIHtcclxuICAgICAgICByZW1vdGVQZWVyID0gX3JlbW90ZVBlZXI7XHJcblxyXG4gICAgICAgIC8vIHNlbmQgY2FsbCBtZXNzYWdlIHRvIHJlbW90ZSBwZWVyXHJcbiAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgIHRvcGljOiAnY2FsbC5vZmZlcicsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gc2V0IFVJIG1lc3NhZ2VcclxuICAgICAgICB1aU1lc3NhZ2UgPSAnY2FsbC5vdXRnb2luZyc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciB3aXRoZHJhd0NhbGwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBzZW5kIHNvY2tldCBtZXNzYWdlXHJcbiAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgIHRvcGljOiAnY2FsbC53aXRoZHJhd24nLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHJlc2V0IHJlbW90ZSBwZWVyXHJcbiAgICAgICAgcmVtb3RlUGVlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIHNldCBVSSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHJlamVjdENhbGwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBzZW5kIHNvY2tldCBtZXNzYWdlXHJcbiAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgIHRvcGljOiAnY2FsbC5yZWplY3RlZCcsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gcmVzZXQgcmVtb3RlIHBlZXJcclxuICAgICAgICByZW1vdGVQZWVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gc2V0IFVJIG1lc3NhZ2VcclxuICAgICAgICB1aU1lc3NhZ2UgPSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYWNjZXB0Q2FsbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIHNlbmQgc29ja2V0IG1lc3NhZ2VcclxuICAgICAgICBTb2NrZXRTcnYuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICB0bzogcmVtb3RlUGVlci5pZCxcclxuICAgICAgICAgICAgdG9waWM6ICdjYWxsLmFjY2VwdGVkJyxcclxuICAgICAgICAgICAgcGF5bG9hZDoge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBzZXQgVUkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9ICdjYWxsLmFjY2VwdGVkJztcclxuXHJcbiAgICAgICAgLy8gc2V0IHJlbW90ZSBwZWVyIGluIFdlYlJUQyBzZXJ2aWNlXHJcbiAgICAgICAgV2ViUlRDU3J2LnNldFJlbW90ZVBlZXIocmVtb3RlUGVlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBoYW5nVXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBzZW5kIHNvY2tldCBtZXNzYWdlXHJcbiAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgIHRvcGljOiAnY2FsbC5oYW5ndXAnLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIFdlYlJUQ1Nydi5jbG9zZUNvbm5lY3Rpb24oKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgU29ja2V0U3J2LmNvbm5lY3QoKTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBTY29wZSBtZXRob2RzIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdXNlci51c2VybmFtZSAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLnVzZXJPYmogPSB7fTtcclxuXHJcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbihpc1ZhbGlkKSB7XHJcbiAgICAgICAgaWYgKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgdXNlci51c2VybmFtZSA9ICRzY29wZS51c2VyT2JqLnVzZXJuYW1lO1xyXG5cclxuICAgICAgICAgICAgLy8gcmVnaXN0ZXIgdXNlcm5hbWUgd2l0aCBzb2NrZXQgc2VydmljZVxyXG4gICAgICAgICAgICBTb2NrZXRTcnYucmVnaXN0ZXIodXNlci51c2VybmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgTG9nU3J2LmVycm9yKCdGb3JtIG5vdCB2YWxpZCcpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLnVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdXNlcjtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLnBlZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIFNvY2tldFNydi5nZXRVc2VycygpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUuZ2V0SW5mb01lc3NhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdWlNZXNzYWdlO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUuZ2V0UmVtb3RlUGVlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiByZW1vdGVQZWVyO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUuY2FsbFVzZXIgPSBjYWxsVXNlcjtcclxuICAgICRzY29wZS53aXRoZHJhd0NhbGwgPSB3aXRoZHJhd0NhbGw7XHJcbiAgICAkc2NvcGUucmVqZWN0Q2FsbCA9IHJlamVjdENhbGw7XHJcbiAgICAkc2NvcGUuYWNjZXB0Q2FsbCA9IGFjY2VwdENhbGw7XHJcbiAgICAkc2NvcGUuaGFuZ1VwID0gaGFuZ1VwO1xyXG4gICAgJHNjb3BlLmlzQ29ubmVjdGVkID0gV2ViUlRDU3J2LmlzQ29ubmVjdGVkO1xyXG5cclxuICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG5cclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBFdmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS4kb24oJ2NhbGwub2ZmZXInLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIGxvb2sgdXAgdXNlclxyXG4gICAgICAgIHJlbW90ZVBlZXIgPSBTb2NrZXRTcnYuZmluZFVzZXJCeUlkKGRhdGEuZnJvbSk7XHJcblxyXG4gICAgICAgIC8vIHNldCB1aSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gJ2NhbGwuaW5jb21pbmcnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignY2FsbC53aXRoZHJhd24nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlc2V0IHJlbW90ZSBwZWVyXHJcbiAgICAgICAgcmVtb3RlUGVlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIHNldCB1aSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gbnVsbDtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2NhbGwucmVqZWN0ZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlc2V0IHJlbW90ZSBwZWVyXHJcbiAgICAgICAgcmVtb3RlUGVlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIHNldCB1aSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gbnVsbDtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2NhbGwuYWNjZXB0ZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHNldCB1aSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gJ2NhbGwuYWNjZXB0ZWQnO1xyXG5cclxuICAgICAgICAvLyBzZXQgcmVtb3RlIHBlZXIgaW4gV2ViUlRDIHNlcnZpY2VcclxuICAgICAgICBXZWJSVENTcnYuc2V0UmVtb3RlUGVlcihyZW1vdGVQZWVyKTtcclxuXHJcbiAgICAgICAgLy8gZXN0YWJsaXNoIFdlYlJUQyBjb25uZWN0aW9uXHJcbiAgICAgICAgV2ViUlRDU3J2LmVzdGFibGlzaENvbm5lY3Rpb24oe1xyXG4gICAgICAgICAgICBpbml0aWF0b3I6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2NhbGwuaGFuZ3VwJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICBXZWJSVENTcnYuY2xvc2VDb25uZWN0aW9uKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCd3ZWJydGMuY29ubmVjdGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgICAgICB1aU1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBGb2N1c1NydignY2hhdE1lc3NhZ2UnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ3dlYnJ0Yy5kaXNjb25uZWN0ZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgICAgIHVpTWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdwbGFpbi13ZWJydGMnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JlYWxUaW1lVmlkZW9Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlKSB7XHJcblxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgncGxhaW4td2VicnRjJylcclxuICAgIC5kaXJlY3RpdmUoJ3JlYWxUaW1lVmlkZW8nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzx2aWRlbyBjbGFzcz1cInZpZGVvXCI+PC92aWRlbz4nLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUmVhbFRpbWVWaWRlb0NvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZpZGVvID0gZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKCd2aWRlbycpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB2aWRlb1dpZHRoLCB2aWRlb0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICB2aWRlby5hdXRvcGxheSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2aWRlby5zcmNPYmplY3QgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZpZGVvLm9ubG9hZGVkbWV0YWRhdGEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWRlb1dpZHRoID0gdGhpcy52aWRlb1dpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvSGVpZ2h0ID0gdGhpcy52aWRlb0hlaWdodDtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJG9uKCd3ZWJydGMuY29ubmVjdGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWRlby5zcmNPYmplY3QgPSBkYXRhLnN0cmVhbTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgncGxhaW4td2VicnRjJylcclxuICAgIC5mYWN0b3J5KCdGb2N1c1NydicsIGZ1bmN0aW9uKCR0aW1lb3V0LCAkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlkKSB7XHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgbWFrZXMgc3VyZSB0aGF0IGlzIGludm9rZWQgYWZ0ZXIgYW55IG90aGVyIGV2ZW50IGhhcyBiZWVuIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgLy8gZS5nLiBjbGljayBldmVudHMgdGhhdCBuZWVkIHRvIHJ1biBiZWZvcmUgdGhlIGZvY3VzIG9yXHJcbiAgICAgICAgICAgIC8vIGlucHV0cyBlbGVtZW50cyB0aGF0IGFyZSBpbiBhIGRpc2FibGVkIHN0YXRlIGJ1dCBhcmUgZW5hYmxlZCB3aGVuIHRob3NlIGV2ZW50c1xyXG4gICAgICAgICAgICAvLyBhcmUgdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdwbGFpbi13ZWJydGMnKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgncGxhaW4td2VicnRjJylcbiAgICAuZmFjdG9yeSgnU29ja2V0U3J2JywgZnVuY3Rpb24oJHJvb3RTY29wZSwgTG9nU3J2KSB7XG4gICAgICAgIHZhciBzb2NrZXQgPSBudWxsO1xuICAgICAgICB2YXIgdXNlcnMgPSBbXTtcbiAgICAgICAgdmFyIG93bklkID0gbnVsbDtcblxuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbihldmVudE5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcblxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbihldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNvbm5lY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGNvbm5lY3QgdG8gU29ja2V0LmlvIHNlcnZlclxuICAgICAgICAgICAgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xuXG4gICAgICAgICAgICBMb2dTcnYuaW5mbygnU29ja2V0IGNvbm5lY3RlZCcpO1xuXG4gICAgICAgICAgICBvbignaWQnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgb3duSWQgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG9uKCd1c2Vycy51cGRhdGUnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VVc2VyQXJyYXkoZGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb24oJ21zZycsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG9waWMgPSBkYXRhLnRvcGljO1xuXG4gICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEudG9waWM7XG5cbiAgICAgICAgICAgICAgICAvLyBwdWJsaXNoIHJlbGF5IG1lc3NhZ2Ugb24gcm9vdCBzY29wZVxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCh0b3BpYywgZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcGFyc2VVc2VyQXJyYXkgPSBmdW5jdGlvbihfdXNlcnMpIHtcbiAgICAgICAgICAgIHVzZXJzID0gX3VzZXJzLmZpbHRlcihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIuaWQgIT09IG93bklkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcm5hbWUpIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdyZWdpc3RlcicsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZW5kTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdtc2cnLCBtZXNzYWdlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZmluZFVzZXJCeUlkID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciB1c2VyID0gbnVsbDtcblxuICAgICAgICAgICAgdXNlcnMuZm9yRWFjaChmdW5jdGlvbih1KSB7XG4gICAgICAgICAgICAgICAgaWYgKHUuaWQgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXIgPSB1O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29ubmVjdDogY29ubmVjdCxcbiAgICAgICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcbiAgICAgICAgICAgIGZpbmRVc2VyQnlJZDogZmluZFVzZXJCeUlkLFxuICAgICAgICAgICAgc2VuZE1lc3NhZ2U6IHNlbmRNZXNzYWdlLFxuICAgICAgICAgICAgZ2V0VXNlcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1c2VycztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwbGFpbi13ZWJydGMnKVxyXG4gICAgLmZhY3RvcnkoJ1dlYlJUQ1NydicsIGZ1bmN0aW9uKCRyb290U2NvcGUsIExvZ1NydiwgU29ja2V0U3J2KSB7XHJcbiAgICAgICAgdmFyIGxvY2FsU3RyZWFtID0gbnVsbDtcclxuICAgICAgICB2YXIgcmVtb3RlU3RyZWFtID0gbnVsbDtcclxuICAgICAgICB2YXIgcGVlckNvbm5lY3Rpb24gPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgZGF0YUNoYW5uZWwgPSBudWxsO1xyXG4gICAgICAgIHZhciBkYXRhQ2hhbm5lbE5hbWUgPSAncGxhaW4td2VicnRjLWNoYW5uZWwnO1xyXG5cclxuICAgICAgICB2YXIgcmVtb3RlUGVlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIFNlcnZpY2UgY29uZmlndXJhdGlvblxyXG4gICAgICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uQ29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IElDRSBzZXJ2ZXIgY29uZmlndXJhdGlvbiwgd2lsbCBiZSBvdmVyd3JpdHRlbiBieSBYSVJTWVMgQVBJIHJlc3BvbnNlXHJcbiAgICAgICAgICAgICAgICBpY2VTZXJ2ZXJzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1widXJsc1wiOiBbXCJzdHVuOjIzLjIxLjE1MC4xMjFcIl19LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcInVybHNcIjogW1wic3R1bjpzdHVuLmwuZ29vZ2xlLmNvbToxOTMwMlwiXX0sXHJcbiAgICAgICAgICAgICAgICAgICAge1widXJsc1wiOiBbXCJ0dXJuOm51bWIudmlhZ2VuaWUuY2E/dHJhbnNwb3J0PXVkcFwiXSwgXCJ1c2VybmFtZVwiOiBcIm1pY2hhZWwuc3RpZnRlckBldm9sYXJpcy5uZXRcIiwgXCJjcmVkZW50aWFsXCI6IFwiMTV1RmJ1Q3hhektyTXpvZzJXbk1cIn0sXHJcbiAgICAgICAgICAgICAgICAgICAge1widXJsc1wiOiBbXCJ0dXJuOm51bWIudmlhZ2VuaWUuY2E/dHJhbnNwb3J0PXRjcFwiXSwgXCJ1c2VybmFtZVwiOiBcIm1pY2hhZWwuc3RpZnRlckBldm9sYXJpcy5uZXRcIiwgXCJjcmVkZW50aWFsXCI6IFwiMTV1RmJ1Q3hhektyTXpvZzJXbk1cIn1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb25Db25zdHJhaW50czoge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9uYWw6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XCJEdGxzU3J0cEtleUFncmVlbWVudFwiOiB0cnVlfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1c2VyTWVkaWFDb25zdHJhaW50czoge1xyXG4gICAgICAgICAgICAgICAgYXVkaW86IHRydWUsXHJcbiAgICAgICAgICAgICAgICB2aWRlbzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0ODAsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAzNjBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGNvbmZpZy5wZWVyQ29ubmVjdGlvbkNvbmZpZywgY29uZmlnLnBlZXJDb25uZWN0aW9uQ29uc3RyYWludHMpO1xyXG5cclxuICAgICAgICAgICAgTG9nU3J2LmluZm8oXCItLS0gcGVlciBjb25uZWN0aW9uIGNyZWF0ZWQgLS0tXCIsIGNvbmZpZy5wZWVyQ29ubmVjdGlvbkNvbmZpZywgY29uZmlnLnBlZXJDb25uZWN0aW9uQ29uc3RyYWludHMpO1xyXG5cclxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24uYWRkU3RyZWFtKGxvY2FsU3RyZWFtKTtcclxuICAgICAgICAgICAgTG9nU3J2LmluZm8oJy0tLSBsb2NhbCBzdHJlYW0gYWRkZWQgLS0tJyk7XHJcblxyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5vbmFkZHN0cmVhbSA9IGhhbmRsZVJlbW90ZVN0cmVhbUFkZGVkO1xyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5vbnJlbW92ZXN0cmVhbSA9IGhhbmRsZVJlbW90ZVN0cmVhbVJlbW92ZWQ7XHJcbiAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gaGFuZGxlSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlO1xyXG5cclxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24ub25pY2VjYW5kaWRhdGUgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmNhbmRpZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNvY2tldFNydi5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiByZW1vdGVQZWVyLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BpYzogJ3dlYnJ0Yy5jYW5kaWRhdGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZXZlbnQuY2FuZGlkYXRlLnNkcE1pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZTogZXZlbnQuY2FuZGlkYXRlLmNhbmRpZGF0ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5vbmRhdGFjaGFubmVsID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gZGF0YSBjaGFubmVsIHJlY2VpdmVkIC0tLScsIGV2ZW50LmNoYW5uZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIGRhdGFDaGFubmVsID0gZXZlbnQuY2hhbm5lbDtcclxuXHJcbiAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbC5vbm9wZW4gPSBoYW5kbGVEYXRhQ2hhbm5lbFN0YXRlQ2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgZGF0YUNoYW5uZWwub25tZXNzYWdlID0gaGFuZGxlRGF0YUNoYW5uZWxNZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgZGF0YUNoYW5uZWwub25jbG9zZSA9IGhhbmRsZURhdGFDaGFubmVsU3RhdGVDaGFuZ2U7XHJcbiAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbC5vbmVycm9yID0gZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKCdkYXRhIGNoYW5uZWwgZXJyb3InLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9mZmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gY3JlYXRpbmcgb2ZmZXIgLS0tJyk7XHJcblxyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5jcmVhdGVPZmZlcigpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihzZXNzaW9uRGVzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKHNlc3Npb25EZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFNvY2tldFNydi5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiByZW1vdGVQZWVyLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BpYzogJ3dlYnJ0Yy5vZmZlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHNlc3Npb25EZXNjcmlwdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBvZmZlcicsIGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gY3JlYXRpbmcgYW5zd2VyIC0tLScpO1xyXG5cclxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHNlc3Npb25EZXNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uLnNldExvY2FsRGVzY3JpcHRpb24oc2Vzc2lvbkRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljOiAnd2VicnRjLmFuc3dlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHNlc3Npb25EZXNjcmlwdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ2ZhaWxlZCB0byBzZXQgbG9jYWwgZGVzY3JpcHRpb24nLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZVJlbW90ZVN0cmVhbUFkZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgTG9nU3J2LmluZm8oXCItLS0gcmVtb3RlIHN0cmVhbSBhZGRlZCAtLS1cIik7XHJcblxyXG4gICAgICAgICAgICBldmVudC5zdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbih0cmFjaykge1xyXG4gICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCJSRU1PVEUgU1RSRUFNIFRSQUNLXCIsIHRyYWNrKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzYXZlIHJlbW90ZSBzdHJlYW0gcmVmZXJlbmNlXHJcbiAgICAgICAgICAgIHJlbW90ZVN0cmVhbSA9IGV2ZW50LnN0cmVhbTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlUmVtb3RlU3RyZWFtUmVtb3ZlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiLS0tIHJlbW90ZSBzdHJlYW0gcmVtb3ZlZCAtLS1cIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZUljZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IChldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50LnRhcmdldCkuaWNlQ29ubmVjdGlvblN0YXRlOyAgLy8gYmVjYXVzZSBvZiBkaWZmZXJlbmNlcyBiZXR3ZWVuIENocm9tZSBhbmQgRmlyZWZveFxyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29ubmVjdGVkJzpcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGNvbm5lY3RlZCAtLS0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3ZWJydGMuY29ubmVjdGVkJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW06IHJlbW90ZVN0cmVhbVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdjbG9zZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gY2xvc2VkIC0tLScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3dlYnJ0Yy5kaXNjb25uZWN0ZWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnZGlzY29ubmVjdGVkJzpcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGRpc2Nvbm5lY3RlZCAtLS0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3ZWJydGMuZGlzY29ubmVjdGVkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlV2ViUlRDQ29ubmVjdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdmYWlsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignLS0tIGZhaWxlZCAtLS0nLCBldmVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbGVhc2UgbWVkaWEgYWNjZXNzIChyZXR1cm5zIGEgcHJvbWlzZSlcclxuICAgICAgICAgICAgICAgICAgICByZWxlYXNlTWVkaWFBY2Nlc3MoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIElDRSBjb25uZWN0aW9uIHN0YXRlIGNoYW5nZSAtLS0nLCBzdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlRGF0YUNoYW5uZWxTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGRhdGEgY2hhbm5lbCBzdGF0ZTogJyArIGRhdGFDaGFubmVsLnJlYWR5U3RhdGUgKyAnIC0tLScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVEYXRhQ2hhbm5lbE1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGRhdGEgY2hhbm5lbCBtZXNzYWdlIC0tLScsIG1lc3NhZ2UpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXF1ZXN0TWVkaWFBY2Nlc3MgPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIG5hdmlnYXRvclxyXG4gICAgICAgICAgICAgICAgICAgIC5tZWRpYURldmljZXNcclxuICAgICAgICAgICAgICAgICAgICAuZ2V0VXNlck1lZGlhKGNvbmZpZy51c2VyTWVkaWFDb25zdHJhaW50cylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihtZWRpYVN0cmVhbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0cmVhbSA9IG1lZGlhU3RyZWFtO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCItLS0gZ290IG1lZGlhIGFjY2VzcyAtLS1cIiwgY29uZmlnLnVzZXJNZWRpYUNvbnN0cmFpbnRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobG9jYWxTdHJlYW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ0ZhaWxlZCB0byBvYnRhaW4gbWVkaWEgYWNjZXNzIGZvciBvcHRpb25zJywgY29uZmlnLnVzZXJNZWRpYUNvbnN0cmFpbnRzLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbGVhc2VNZWRpYUFjY2VzcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIHByb21pc2UgaW1tZWRpYXRlbHkgaWYgbWVkaWEgYWNjZXNzIGhhcyBhbHJlYWR5IGJlZW4gcmVsZWFzZWRcclxuICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0cmVhbSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJhY2tzID0gbG9jYWxTdHJlYW0uZ2V0VHJhY2tzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdHJhY2tzLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0cmFjay5zdG9wKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0cmVhbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZXN0YWJsaXNoQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgcmVxdWVzdE1lZGlhQWNjZXNzKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgaW5pdCBtZXNzYWdlIHRvIHJlbW90ZSBwZWVyXHJcbiAgICAgICAgICAgICAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljOiAnd2VicnRjLmluaXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluaXQgcGVlciBjb25uZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZ3VwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChwZWVyQ29ubmVjdGlvbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24uY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgbG9jYWxTdHJlYW0gPSBudWxsO1xyXG4gICAgICAgICAgICByZW1vdGVTdHJlYW0gPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjbG9zZVdlYlJUQ0Nvbm5lY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHBlZXJDb25uZWN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGNsb3NpbmcgV2ViUlRDIGNvbm5lY3Rpb24gLS0tJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVsZWFzZU1lZGlhQWNjZXNzKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZ3VwKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRSZW1vdGVQZWVyKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFJlbW90ZVBlZXIgPSBmdW5jdGlvbihwZWVyKSB7XHJcbiAgICAgICAgICAgIHJlbW90ZVBlZXIgPSBwZWVyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc0Nvbm5lY3RlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGVlckNvbm5lY3Rpb24gIT09IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJ3dlYnJ0Yy5pbml0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgTG9nU3J2LmluZm8oJy0tLSByZWNlaXZlZCBXZWJSVEMgaW5pdCAtLS0nKTtcclxuXHJcbiAgICAgICAgICAgIHJlcXVlc3RNZWRpYUFjY2VzcygpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0IHBlZXIgY29ubmVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIGluaXQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb3BlbiBkYXRhIGNoYW5uZWxcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbCA9IHBlZXJDb25uZWN0aW9uLmNyZWF0ZURhdGFDaGFubmVsKGRhdGFDaGFubmVsTmFtZSwgeyByZWxpYWJsZTogdHJ1ZSB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gZGF0YSBjaGFubmVsIGNyZWF0ZWQgLS0tJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbC5vbm9wZW4gPSBoYW5kbGVEYXRhQ2hhbm5lbFN0YXRlQ2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbC5vbm1lc3NhZ2UgPSBoYW5kbGVEYXRhQ2hhbm5lbE1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFDaGFubmVsLm9uY2xvc2UgPSBoYW5kbGVEYXRhQ2hhbm5lbFN0YXRlQ2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbC5vbmVycm9yID0gZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ2RhdGEgY2hhbm5lbCBlcnJvcicsIGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ2ZhaWxlZCB0byBjcmVhdGUgZGF0YSBjaGFubmVsJywgZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ2hhbm5lbCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHNlc3Npb24gZGVzY3JpcHRpb24gb2ZmZXJcclxuICAgICAgICAgICAgICAgICAgICBvZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJ3dlYnJ0Yy5vZmZlcicsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCctLS0gcmVjZWl2ZWQgb2ZmZXIgLS0tJywgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKGRhdGEucGF5bG9hZCkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIHNldCByZW1vdGUgZGVzY3JpcHRpb24gLS0tJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignZmFpbGVkIHRvIHNldCByZW1vdGUgZGVzY3JpcHRpb24nLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd3ZWJydGMuYW5zd2VyJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgTG9nU3J2LmluZm8oJy0tLSByZWNlaXZlZCBhbnN3ZXIgLS0tJywgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKGRhdGEucGF5bG9hZCkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIHNldCByZW1vdGUgZGVzY3JpcHRpb24gLS0tJyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignZmFpbGVkIHRvIHNldCByZW1vdGUgZGVzY3JpcHRpb24nLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd3ZWJydGMuY2FuZGlkYXRlJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKHBlZXJDb25uZWN0aW9uLnJlbW90ZURlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5hZGRJY2VDYW5kaWRhdGUobmV3IFJUQ0ljZUNhbmRpZGF0ZShkYXRhLnBheWxvYWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnLS0tIGFkZGVkIElDRSBjYW5kaWRhdGUgLS0tJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignZmFpbGVkIHRvIGFkZCBJQ0UgY2FuZGlkYXRlJywgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBlc3RhYmxpc2hDb25uZWN0aW9uOiBlc3RhYmxpc2hDb25uZWN0aW9uLFxyXG4gICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb246IGNsb3NlV2ViUlRDQ29ubmVjdGlvbixcclxuICAgICAgICAgICAgc2V0UmVtb3RlUGVlcjogc2V0UmVtb3RlUGVlcixcclxuICAgICAgICAgICAgaXNDb25uZWN0ZWQ6IGlzQ29ubmVjdGVkXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
