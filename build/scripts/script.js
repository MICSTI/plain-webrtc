var app=angular.module("plain-webrtc",["ui.router","ngMessages"]);app.constant("AppConfig",{"log.info":!0,"log.error":!0}),app.controller("AppCtrl",["$scope","LogSrv","SocketSrv","FocusSrv",function(n,e,o,t){var r={username:null},c=null,l=null,u=function(n){c=n,o.sendMessage({to:c.id,topic:"call.offer",payload:{}}),l="call.outgoing"},a=function(){o.sendMessage({to:c.id,topic:"call.withdrawn",payload:{}}),c=null,l=null},i=function(){o.sendMessage({to:c.id,topic:"call.rejected",payload:{}}),c=null,l=null},f=function(){o.sendMessage({to:c.id,topic:"call.accepted",payload:{}}),l="call.accepted"};o.connect(),n.isLoggedIn=function(){return null!==r.username},n.userObj={},n.login=function(t){t?(r.username=n.userObj.username,e.info(r),o.register(r.username)):e.error("Form not valid")},n.user=function(){return r},n.peers=function(){return o.getUsers()},n.getInfoMessage=function(){return l},n.getRemotePeer=function(){return c},n.callUser=u,n.withdrawCall=a,n.rejectCall=i,n.acceptCall=f,t("username"),n.$on("call.offer",function(n,e){c=o.findUserById(e.from),l="call.incoming"}),n.$on("call.withdrawn",function(n,e){c=null,l=null}),n.$on("call.rejected",function(n,e){c=null,l=null}),n.$on("call.accepted",function(n,e){l="call.accepted"})}]),angular.module("plain-webrtc").factory("FocusSrv",["$timeout","$window",function(n,e){return function(o){n(function(){var n=e.document.getElementById(o);n&&n.focus()})}}]),angular.module("plain-webrtc").factory("LogSrv",["AppConfig",function(n){var e=function(){n["log.info"]&&console.log.apply(console,arguments)},o=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:e,error:o}}]),angular.module("plain-webrtc").factory("SocketSrv",["$rootScope","LogSrv",function(n,e){var o=null,t=[],r=null,c=function(e,t){o.on(e,function(){var e=arguments;n.$apply(function(){t.apply(o,e)})})},l=function(){o=io.connect(),e.info("Socket connected"),c("id",function(n){r=n}),c("users.update",function(n){u(n)}),c("msg",function(e){var o=e.topic;delete e.topic,n.$broadcast(o,e)})},u=function(n){t=n.filter(function(n){return n.id!==r})},a=function(n){o.emit("register",{username:n})},i=function(n){o.emit("msg",n)},f=function(n){var e=null;return t.forEach(function(o){o.id===n&&(e=o)}),e};return{connect:l,register:a,findUserById:f,sendMessage:i,getUsers:function(){return t}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNlcnZpY2VzL2ZvY3VzLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9sb2cuc2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldC5pby5jbGllbnQuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJsb2cuaW5mbyIsImxvZy5lcnJvciIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJMb2dTcnYiLCJTb2NrZXRTcnYiLCJGb2N1c1NydiIsInVzZXIiLCJ1c2VybmFtZSIsInJlbW90ZVBlZXIiLCJ1aU1lc3NhZ2UiLCJjYWxsVXNlciIsIl9yZW1vdGVQZWVyIiwic2VuZE1lc3NhZ2UiLCJ0byIsImlkIiwidG9waWMiLCJwYXlsb2FkIiwid2l0aGRyYXdDYWxsIiwicmVqZWN0Q2FsbCIsImFjY2VwdENhbGwiLCJjb25uZWN0IiwiaXNMb2dnZWRJbiIsInVzZXJPYmoiLCJsb2dpbiIsImlzVmFsaWQiLCJpbmZvIiwicmVnaXN0ZXIiLCJlcnJvciIsInBlZXJzIiwiZ2V0VXNlcnMiLCJnZXRJbmZvTWVzc2FnZSIsImdldFJlbW90ZVBlZXIiLCIkb24iLCJldmVudCIsImRhdGEiLCJmaW5kVXNlckJ5SWQiLCJmcm9tIiwiZmFjdG9yeSIsIiR0aW1lb3V0IiwiJHdpbmRvdyIsImVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZm9jdXMiLCJBcHBDb25maWciLCJsb2dJbmZvIiwiY29uc29sZSIsImxvZyIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9nRXJyb3IiLCIkcm9vdFNjb3BlIiwic29ja2V0IiwidXNlcnMiLCJvd25JZCIsIm9uIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiJGFwcGx5IiwiaW8iLCJwYXJzZVVzZXJBcnJheSIsIiRicm9hZGNhc3QiLCJfdXNlcnMiLCJmaWx0ZXIiLCJlbWl0IiwibWVzc2FnZSIsImZvckVhY2giLCJ1Il0sIm1hcHBpbmdzIjoiQUFB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U0FBQXJCLEdBQ0EyQixFQUFBM0IsS0FHQXFCLEVBQUEsTUFBQSxTQUFBckIsR0FDQSxHQUFBbkIsR0FBQW1CLEVBQUFuQixZQUVBbUIsR0FBQW5CLE1BR0FvQyxFQUFBVyxXQUFBL0MsRUFBQW1CLE1BSUEyQixFQUFBLFNBQUFFLEdBQ0FWLEVBQUFVLEVBQUFDLE9BQUEsU0FBQTFELEdBQ0EsTUFBQUEsR0FBQVEsS0FBQXdDLEtBSUE1QixFQUFBLFNBQUFuQixHQUNBNkMsRUFBQWEsS0FBQSxZQUNBMUQsU0FBQUEsS0FJQUssRUFBQSxTQUFBc0QsR0FDQWQsRUFBQWEsS0FBQSxNQUFBQyxJQUdBL0IsRUFBQSxTQUFBckIsR0FDQSxHQUFBUixHQUFBLElBUUEsT0FOQStDLEdBQUFjLFFBQUEsU0FBQUMsR0FDQUEsRUFBQXRELEtBQUFBLElBQ0FSLEVBQUE4RCxLQUlBOUQsRUFHQSxRQUNBYyxRQUFBQSxFQUNBTSxTQUFBQSxFQUNBUyxhQUFBQSxFQUNBdkIsWUFBQUEsRUFDQWlCLFNBQUEsV0FDQSxNQUFBd0IiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwicGxhaW4td2VicnRjXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nTWVzc2FnZXMnXHJcbl0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5hcHAuY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZVxyXG59KTtcclxuXHJcbmFwcC5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgU29ja2V0U3J2LCBGb2N1c1Nydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgIHZhciB1c2VyID0ge1xyXG4gICAgICAgIHVzZXJuYW1lOiBudWxsXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciByZW1vdGVQZWVyID0gbnVsbDtcclxuICAgIHZhciB1aU1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgIHZhciBjYWxsVXNlciA9IGZ1bmN0aW9uKF9yZW1vdGVQZWVyKSB7XHJcbiAgICAgICAgcmVtb3RlUGVlciA9IF9yZW1vdGVQZWVyO1xyXG5cclxuICAgICAgICAvLyBzZW5kIGNhbGwgbWVzc2FnZSB0byByZW1vdGUgcGVlclxyXG4gICAgICAgIFNvY2tldFNydi5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgIHRvOiByZW1vdGVQZWVyLmlkLFxyXG4gICAgICAgICAgICB0b3BpYzogJ2NhbGwub2ZmZXInLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHNldCBVSSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gJ2NhbGwub3V0Z29pbmcnO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgd2l0aGRyYXdDYWxsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gc2VuZCBzb2NrZXQgbWVzc2FnZVxyXG4gICAgICAgIFNvY2tldFNydi5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgIHRvOiByZW1vdGVQZWVyLmlkLFxyXG4gICAgICAgICAgICB0b3BpYzogJ2NhbGwud2l0aGRyYXduJyxcclxuICAgICAgICAgICAgcGF5bG9hZDoge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyByZXNldCByZW1vdGUgcGVlclxyXG4gICAgICAgIHJlbW90ZVBlZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBzZXQgVUkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciByZWplY3RDYWxsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gc2VuZCBzb2NrZXQgbWVzc2FnZVxyXG4gICAgICAgIFNvY2tldFNydi5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgIHRvOiByZW1vdGVQZWVyLmlkLFxyXG4gICAgICAgICAgICB0b3BpYzogJ2NhbGwucmVqZWN0ZWQnLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHJlc2V0IHJlbW90ZSBwZWVyXHJcbiAgICAgICAgcmVtb3RlUGVlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIHNldCBVSSBtZXNzYWdlXHJcbiAgICAgICAgdWlNZXNzYWdlID0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFjY2VwdENhbGwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBzZW5kIHNvY2tldCBtZXNzYWdlXHJcbiAgICAgICAgU29ja2V0U3J2LnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgdG86IHJlbW90ZVBlZXIuaWQsXHJcbiAgICAgICAgICAgIHRvcGljOiAnY2FsbC5hY2NlcHRlZCcsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gc2V0IFVJIG1lc3NhZ2VcclxuICAgICAgICB1aU1lc3NhZ2UgPSAnY2FsbC5hY2NlcHRlZCc7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBpbml0aWFsaXphdGlvbiAtLS0tLS0tLS0tLS1cclxuICAgIFNvY2tldFNydi5jb25uZWN0KCk7XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gU2NvcGUgbWV0aG9kcyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5pc0xvZ2dlZEluID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHVzZXIudXNlcm5hbWUgIT09IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS51c2VyT2JqID0ge307XHJcblxyXG4gICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oaXNWYWxpZCkge1xyXG4gICAgICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIHVzZXIudXNlcm5hbWUgPSAkc2NvcGUudXNlck9iai51c2VybmFtZTtcclxuICAgICAgICAgICAgTG9nU3J2LmluZm8odXNlcik7XHJcblxyXG4gICAgICAgICAgICAvLyByZWdpc3RlciB1c2VybmFtZSB3aXRoIHNvY2tldCBzZXJ2aWNlXHJcbiAgICAgICAgICAgIFNvY2tldFNydi5yZWdpc3Rlcih1c2VyLnVzZXJuYW1lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ0Zvcm0gbm90IHZhbGlkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUudXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUucGVlcnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gU29ja2V0U3J2LmdldFVzZXJzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5nZXRJbmZvTWVzc2FnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB1aU1lc3NhZ2U7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5nZXRSZW1vdGVQZWVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlbW90ZVBlZXI7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5jYWxsVXNlciA9IGNhbGxVc2VyO1xyXG4gICAgJHNjb3BlLndpdGhkcmF3Q2FsbCA9IHdpdGhkcmF3Q2FsbDtcclxuICAgICRzY29wZS5yZWplY3RDYWxsID0gcmVqZWN0Q2FsbDtcclxuICAgICRzY29wZS5hY2NlcHRDYWxsID0gYWNjZXB0Q2FsbDtcclxuXHJcbiAgICBGb2N1c1NydigndXNlcm5hbWUnKTtcclxuXHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gRXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuJG9uKCdjYWxsLm9mZmVyJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBsb29rIHVwIHVzZXJcclxuICAgICAgICByZW1vdGVQZWVyID0gU29ja2V0U3J2LmZpbmRVc2VyQnlJZChkYXRhLmZyb20pO1xyXG5cclxuICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9ICdjYWxsLmluY29taW5nJztcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2NhbGwud2l0aGRyYXduJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZXNldCByZW1vdGUgcGVlclxyXG4gICAgICAgIHJlbW90ZVBlZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9IG51bGw7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdjYWxsLnJlamVjdGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZXNldCByZW1vdGUgcGVlclxyXG4gICAgICAgIHJlbW90ZVBlZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9IG51bGw7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdjYWxsLmFjY2VwdGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzZXQgdWkgbWVzc2FnZVxyXG4gICAgICAgIHVpTWVzc2FnZSA9ICdjYWxsLmFjY2VwdGVkJztcclxuICAgIH0pO1xyXG59KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdwbGFpbi13ZWJydGMnKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3BsYWluLXdlYnJ0YycpXHJcbiAgICAuZmFjdG9yeSgnTG9nU3J2JywgZnVuY3Rpb24oQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGxvZ0luZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5pbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuZXJyb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGVycm9yOiBsb2dFcnJvclxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdwbGFpbi13ZWJydGMnKVxuICAgIC5mYWN0b3J5KCdTb2NrZXRTcnYnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCBMb2dTcnYpIHtcbiAgICAgICAgdmFyIHNvY2tldCA9IG51bGw7XG4gICAgICAgIHZhciB1c2VycyA9IFtdO1xuICAgICAgICB2YXIgb3duSWQgPSBudWxsO1xuXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29ubmVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gY29ubmVjdCB0byBTb2NrZXQuaW8gc2VydmVyXG4gICAgICAgICAgICBzb2NrZXQgPSBpby5jb25uZWN0KCk7XG5cbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCdTb2NrZXQgY29ubmVjdGVkJyk7XG5cbiAgICAgICAgICAgIG9uKCdpZCcsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBvd25JZCA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb24oJ3VzZXJzLnVwZGF0ZScsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBwYXJzZVVzZXJBcnJheShkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBvbignbXNnJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciB0b3BpYyA9IGRhdGEudG9waWM7XG5cbiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS50b3BpYztcblxuICAgICAgICAgICAgICAgIC8vIHB1Ymxpc2ggcmVsYXkgbWVzc2FnZSBvbiByb290IHNjb3BlXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KHRvcGljLCBkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBwYXJzZVVzZXJBcnJheSA9IGZ1bmN0aW9uKF91c2Vycykge1xuICAgICAgICAgICAgdXNlcnMgPSBfdXNlcnMuZmlsdGVyKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlci5pZCAhPT0gb3duSWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbih1c2VybmFtZSkge1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3JlZ2lzdGVyJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNlbmRNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ21zZycsIG1lc3NhZ2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBmaW5kVXNlckJ5SWQgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIHVzZXIgPSBudWxsO1xuXG4gICAgICAgICAgICB1c2Vycy5mb3JFYWNoKGZ1bmN0aW9uKHUpIHtcbiAgICAgICAgICAgICAgICBpZiAodS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlciA9IHU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb25uZWN0OiBjb25uZWN0LFxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxuICAgICAgICAgICAgZmluZFVzZXJCeUlkOiBmaW5kVXNlckJ5SWQsXG4gICAgICAgICAgICBzZW5kTWVzc2FnZTogc2VuZE1lc3NhZ2UsXG4gICAgICAgICAgICBnZXRVc2VyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
